<mvc:View
    controllerName="uiprojectmanagement.controller.View1"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:t="sap.ui.table"
    xmlns:core="sap.ui.core"
    xmlns:gantt="sap.gantt.simple">

    <f:DynamicPage>
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="Projects &amp; Tasks â€“ Data Verification"/>
                </f:heading>
            </f:DynamicPageTitle>
        </f:title>

        <f:content>
            <VBox class="sapUiSmallMargin">

                <Title text="Projects (Flat)" level="H2" class="sapUiSmallMarginBottom"/>
                <Table items="{/Projects}" growing="true" growingScrollToLoad="true">
                    <columns>
                        <Column><Text text="Project ID"/></Column>
                        <Column><Text text="Title"/></Column>
                        <Column><Text text="Status"/></Column>
                        <Column><Text text="Start Date"/></Column>
                        <Column><Text text="End Date"/></Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <cells>
                                <Text text="{ID}"/>
                                <Text text="{title}"/>
                                <Text text="{status}"/>
                                <Text text="{startDate}"/>
                                <Text text="{endDate}"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>

                <Toolbar class="sapUiSmallMarginTop"/>

                <Title text="Tasks (Flat)" level="H2" class="sapUiSmallMarginBottom"/>
                <Table items="{/Tasks}" growing="true" growingScrollToLoad="true">
                    <columns>
                        <Column><Text text="Task ID"/></Column>
                        <Column><Text text="Title"/></Column>
                        <Column><Text text="Project ID"/></Column>
                        <Column><Text text="Progress"/></Column>
                        <Column><Text text="Start"/></Column>
                        <Column><Text text="End"/></Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <cells>
                                <Text text="{ID}"/>
                                <Text text="{title}"/>
                                <Text text="{project_ID}"/>
                                <Text text="{progress}%"/>
                                <Text text="{startDate}"/>
                                <Text text="{endDate}"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>

                <Toolbar class="sapUiSmallMarginTop"/>

                <Title text="Project Hierarchy (WBS)" level="H2" class="sapUiSmallMarginBottom"/>
                
                <t:TreeTable
                    id="TreeTable"
                    selectionMode="Single"
                    rows="{
                        path: '/HierarchyNodes',
                        parameters: {
                            $count: true,
                            $$ownRequest: true,
                            $orderby: 'startDate asc'
                        }
                    }">
                    <t:columns>
                        <t:Column label="WBS Structure" width="20rem">
                            <t:template>
                                <HBox>
                                    <core:Icon 
                                        src="{= ${type} === 'Project' ? 'sap-icon://product' : 'sap-icon://task'}" 
                                        color="{= ${type} === 'Project' ? '#0070b4' : '#6a6d70' }"
                                        class="sapUiTinyMarginEnd"/>
                                    <Text text="{title}" design="{= ${type} === 'Project' ? 'Bold' : 'Standard'}"/>
                                </HBox>
                            </t:template>
                        </t:Column>
                        <t:Column label="Start Date">
                            <t:template><Text text="{startDate}"/></t:template>
                        </t:Column>
                         <t:Column label="End Date">
                            <t:template><Text text="{endDate}"/></t:template>
                        </t:Column>
                        <t:Column label="Status / Progress">
                            <t:template><Text text="{statusOrProgress}"/></t:template>
                        </t:Column>
                    </t:columns>
                </t:TreeTable>

                <Toolbar class="sapUiSmallMarginTop"/>

                <Title text="Project Timeline (Gantt)" level="H2" class="sapUiSmallMarginBottom"/>
                
                <gantt:GanttChartContainer id="ganttContainer" height="500px">
                    <gantt:toolbar>
                        <gantt:ContainerToolbar>
                            <gantt:content>
                                <Button icon="sap-icon://zoom-in" press="onZoomIn"/>
                                <Button icon="sap-icon://zoom-out" press="onZoomOut"/>
                            </gantt:content>
                        </gantt:ContainerToolbar>
                    </gantt:toolbar>
                    
                    <gantt:ganttCharts>
                        <gantt:GanttChartWithTable id="ganttChart" shapeDrop="onShapeDrop">
                            <gantt:table>
                                <t:TreeTable
                                    selectionMode="Single"
                                    rows="{
                                        path: '/HierarchyNodes',
                                        parameters: {
                                            $count: true,
                                            $$ownRequest: true,
                                            $orderby: 'startDate asc'
                                        }
                                    }">
                                    <t:columns>
                                        <t:Column label="Structure" width="15rem">
                                            <t:template>
                                                <Text text="{title}" design="{= ${type} === 'Project' ? 'Bold' : 'Standard'}"/>
                                            </t:template>
                                        </t:Column>
                                    </t:columns>
                                    
                                    <t:rowSettingsTemplate>
                                        <gantt:GanttRowSettings>
                                            <gantt:shapes1>
                                                
                                                <gantt:BaseChevron 
                                                    time="{startDate}" 
                                                    endTime="{endDate}" 
                                                    title="{title}"
                                                    fill="#0070b4"
                                                    visible="{= ${type} === 'Project' }"/>

                                                <gantt:BaseRectangle 
                                                    time="{startDate}" 
                                                    endTime="{endDate}" 
                                                    title="{title}"
                                                    fill="#759421"
                                                    visible="{= ${type} === 'Task' }"/>

                                            </gantt:shapes1>
                                        </gantt:GanttRowSettings>
                                    </t:rowSettingsTemplate>

                                </t:TreeTable>
                            </gantt:table>
                        </gantt:GanttChartWithTable>
                    </gantt:ganttCharts>
                </gantt:GanttChartContainer>

            </VBox>
        </f:content>
    </f:DynamicPage>
</mvc:View>